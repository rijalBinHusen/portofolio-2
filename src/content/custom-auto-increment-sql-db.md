---
title:  "Auto increment sql database with custom value"
description: "Implement custome auto increment primary key 23230001 instead of 1, 2, 3, 4 ...."
date: 2023-06-06
img: '/kindness.jpg'
tags: [sql, database, trigger]
---
In this blog post, we will discuss how to implement auto increment with custom value in MySQL. Auto increment is a feature of MySQL that allows you to automatically generate unique values for your database rows. This can be useful for keeping track of records in your database, as you don't have to worry about manually assigning values.

However, sometimes you may want to use a custom value for your auto increment column. This could be for a number of reasons, such as if you want to use a sequential number for your records, or if you want to use a unique identifier that is generated by your application.

In this blog post, we will show you how to implement auto increment with custom value in MySQL. We will also discuss the benefits of using custom values for your auto increment column.

Here are some of the benefits of using custom values for your auto increment column:

- Uniqueness: Custom values are guaranteed to be unique, which can be helpful for keeping track of records in your database.
- Efficiency: Using custom values can help to improve the efficiency of your database queries.
- Flexibility: Custom values give you more flexibility in how you manage your database records.

Initially I did custom incement key to FrontEnd application ...., yes I build offline application using only FrontEnd application and I stored all data of it appliaction in [indexeddb](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API), and also of course I have made a mistake.

Saya menggunakan bantuan library [localforage](https://github.com/localForage/localForage) untuk terhubung ke API indexeddb dan memanipulasi data didalamnya, semua menipulasi data di indexeddb menggunakan satu file kode sebagai tulang punggung, dan setiap ada penambahan data baru akan diberikan uniquee increment id, kode untuk menghasilkan increment id adalah sebagai berikut :

```JavaScript
export function generateId(lastId) {
    // ambil last id dari summary  // kalau tidak ada bikin baru
    let id = lastId.slice(0, -8);
    // masukkan increment
    // ambil 4 string e.g 0000 akan menjadi 0001
    let increment = Number(lastId.slice(-4)) + 1 + "";
    // 2022
    let fullYear = new Date().getFullYear() + "";
    // 5
    let weekNow = getWeekNumber();
    // 22
    let year = lastId.slice(id.length, id.length+2); //21
    // 05
    let week = lastId.slice(id.length + 2, id.length+4); //08
    //if the week same
    if (weekNow === Number(week) && Number(year) === Number(fullYear.slice(-2))) {
      id += year + week;
    }
    //if the week not same
    else {
      // if the week 9 change to 09
      weekNow = weekNow < 9 ? "0" + weekNow : weekNow;
      id += fullYear.slice(-2) + weekNow;
      increment = "0";
    }
    //0000
    let result = id + "0000".slice(increment.length) + increment;
  
    return result;
  }
  
  function getWeekNumber() {
    // get today
    let currentdate = new Date();
    // get the 1 january day
    var oneJan = new Date(currentdate.getFullYear(), 0, 1);
    // get the number of today (currentdate - oneJan) would be epoch number and divide 1 day epoch number
    var numberOfDays = Math.floor((currentdate - oneJan) / (24 * 60 * 60 * 1000));
    // get the number of day + 1 + number of days and divide 1 week ( 170 / 7)
    return Math.ceil((currentdate.getDay() + 1 + numberOfDays) / 7);
  }
  
```

Seperti yang terlihat diatas, ketika kita menjalankan *generateId(SU_23060000)* maka kita akan mendapatkan hasil SU_23060001 kurang lebih berjalan seperti ini:
  - *generateId(SU_23060000)* => SU_23060001
  - *generateId(SU_23060001)* => SU_23060002
  - *generateId(SU_23060002)* => SU_23060003
  - *generateId(SU_23060003)* => SU_23060004
  - *generateId(SU_23060004)* => SU_23060005
  - dan seterusnya

Detail dari hasil generate id diatas adalah sebagai berikut :
  - SUPER_ = nama dari table atau nama kategory atau apapun yang kamu inginkan
  - 23 = tahun
  - 06 = week
  - 0001 = uniquee id

dikarenakan saya tidak melakukan unit testing pada kode tersebut, saya merasa semua baik baik saja, tetapi setelah aplikasi saya berjalan beberapa bulan, dan *getWeekNumber* function mengembelikan angka 9, aplikasi saya tidak berjalan sebagaimana mestinya, sebagai berikut:
  - *generateId(SU_23000000)* => SU_2390000
  - *generateId(SU_2390000)* => SU2390000
  - *generateId(SU2390000)* => S2390000
  - *generateId(2390000)* => 2390000
  - *generateId(2390000)* => 2390000
  - and all next id would be 2390000

Semua item yang dibuat pada hari tersebut memiliki id 2390000 dan tentu saja setiap item baru yang diberikan id 2390000 akan menimpa record yang sebelumnya, sehingga seolah olah record hanya dibuat 1 kali saja meskipun kita memasukkan data sebanyak banyaknya.

*weekNow = weekNow < 9 ? "0" + weekNow : weekNow;*,




iya kamu benar, seharunya saya menggunakan *< 10* disitu, saya ganti kode tersebut dan tidak lupa untuk melakukan unit testing dengan cara generateId selama 12 Bulan penuh aplikasi saya berjalan normal seperti biasa.

Dikarenakan javascript adalah bahasa pemrograman yang single thread dan non blocking, semua proses pada aplikasi akan dilakukan secara berurutan, kemudian saya mencoba untuk membuat BackEnd untuk aplikasi saya diatas dan tentu saja akan muncul masalah berikutnya :).

https://www.mysqltutorial.org/create-the-first-trigger-in-mysql.aspx
https://www.w3schools.com/sql/func_mysql_week.asp
https://stackoverflow.com/questions/17893988/how-to-make-mysql-table-primary-key-auto-increment-with-some-prefix